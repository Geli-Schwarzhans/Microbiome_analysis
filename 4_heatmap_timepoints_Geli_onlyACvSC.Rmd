---
title: "pheatmap demo"
author: "Bela Hausmann (Joint Microbiome Facility)"
output:
  html_document:
    toc: yes
    toc_float:
      collapsed: no
      smooth_scroll: no
editor_options: 
  chunk_output_type: console
---

# remove all the objects from the R session
```{r}
rm(list=ls())#rmove all data
```

```{r}
source("0_common.R", chdir = TRUE)
library(mia)
library(pheatmap)
library(gplots)
library("svglite")
```


# Load containers
```{r}
SE_abs <- readRDS(file.path(RD_DIR, "SE_abs_all_finalremovedSamples.rds"))

SE <- SE_abs[, SE_abs$collection_date %in% c("0","5", "11","20", "35")]
#SE <- SE_abs[, SE_abs$Species %in% c("Ac", "UV7")]


# Get the 'Family' column from the rowData of 'SE'
family_column <- rowData(SE)$Family
domain_column <- rowData(SE)$Domain
# Extract unique names listed under 'Family'
unique_family_names <- unique(family_column)

# Print the unique family names
print(unique_family_names)
```

```{r}
# let's remind ourselves which assay we have available to us
assayNames(SE)
# make custom order of the Samples
SE$collection_date <- factor(SE$collection_date, levels =c("0","5", "11","20", "35"))
```

```{r}
#file1 <- file.path(DiffAbund_DIR, "SC_Ac_DESeq2_results_in_a_loop.tsv")
#DESeq2_results1 <- fread(file1)
file2 <- file.path(DiffAbund_DIR, "Ac_E25_DESeq2_results_in_a_loop.tsv")
DESeq2_results2 <- fread(file2)
file3 <- file.path(DiffAbund_DIR, "Ac_UV7_DESeq2_results_in_a_loop.tsv")
DESeq2_results3 <- fread(file3)



```

# combine files at each timepoint
```{r}
############################################# T0 ################################################################

# Filter rows where Collection_date is 0
#dt_filtered1_0 <- DESeq2_results1[Collection_date == 0]
dt_filtered2_0 <- DESeq2_results2[Collection_date == 0]
dt_filtered3_0 <- DESeq2_results3[Collection_date == 0]

columns_to_keep <- c("Feature_ID", "log2FoldChange", "Collection_date","padj", "Species_group1", "Species_group2")

#dt_filtered1_0 <- na.omit(dt_filtered1_0[, ..columns_to_keep, with = FALSE])
dt_filtered2_0 <- na.omit(dt_filtered2_0[, ..columns_to_keep, with = FALSE])
dt_filtered3_0 <- na.omit(dt_filtered3_0[, ..columns_to_keep, with = FALSE])

# Combine data.tables by row
#combined_dt_0 <- rbindlist(list(dt_filtered1_0, dt_filtered2_0, dt_filtered3_0), fill = TRUE)
combined_dt_0 <- rbindlist(list(dt_filtered2_0, dt_filtered3_0), fill = TRUE)

newcombined_dt_0 <- subset(combined_dt_0, padj < 0.05)

# Merge rows based on the Feature_ID column
#newcombined_dt_0 <- combined_dt_0[, lapply(.SD, function(x) if(all(is.na(x))) NA else x), by = Feature_ID]

############################################# T5 ################################################################
# Filter rows where Collection_date is 0
#dt_filtered1_5 <- DESeq2_results1[Collection_date == 5]
dt_filtered2_5 <- DESeq2_results2[Collection_date == 5]
dt_filtered3_5 <- DESeq2_results3[Collection_date == 5]

columns_to_keep <- c("Feature_ID", "log2FoldChange", "Collection_date","padj", "Species_group1", "Species_group2")

#dt_filtered1_5 <- na.omit(dt_filtered1_5[, ..columns_to_keep, with = FALSE])
dt_filtered2_5 <- na.omit(dt_filtered2_5[, ..columns_to_keep, with = FALSE])
dt_filtered3_5 <- na.omit(dt_filtered3_5[, ..columns_to_keep, with = FALSE])

# Combine data.tables by row
#combined_dt_5 <- rbindlist(list(dt_filtered1_5, dt_filtered2_5, dt_filtered3_5), fill = TRUE)
combined_dt_5 <- rbindlist(list(dt_filtered2_5, dt_filtered3_5), fill = TRUE)

newcombined_dt_5 <- subset(combined_dt_5, padj < 0.05)

# Merge rows based on the Feature_ID column
#newcombined_dt_5 <- combined_dt_5[, lapply(.SD, function(x) if(all(is.na(x))) NA else x), by = Feature_ID]

############################################# T11 ################################################################
# Filter rows where Collection_date is 0
#dt_filtered1_11 <- DESeq2_results1[Collection_date == 11]
dt_filtered2_11 <- DESeq2_results2[Collection_date == 11]
dt_filtered3_11 <- DESeq2_results3[Collection_date == 11]

columns_to_keep <- c("Feature_ID", "log2FoldChange", "Collection_date","padj", "Species_group1", "Species_group2")

#dt_filtered1_11 <- na.omit(dt_filtered1_11[, ..columns_to_keep, with = FALSE])
dt_filtered2_11 <- na.omit(dt_filtered2_11[, ..columns_to_keep, with = FALSE])
dt_filtered3_11 <- na.omit(dt_filtered3_11[, ..columns_to_keep, with = FALSE])

# Combine data.tables by row
#combined_dt_11 <- rbindlist(list(dt_filtered1_11, dt_filtered2_11, dt_filtered3_11), fill = TRUE)
combined_dt_11 <- rbindlist(list(dt_filtered2_11, dt_filtered3_11), fill = TRUE)

newcombined_dt_11 <- subset(combined_dt_11, padj < 0.05)

# Merge rows based on the Feature_ID column
#newcombined_dt_11 <- combined_dt_11[, lapply(.SD, function(x) if(all(is.na(x))) NA else x), by = Feature_ID]

############################################# T20 ################################################################
# Filter rows where Collection_date is 0
#dt_filtered1_20 <- DESeq2_results1[Collection_date == 20]
dt_filtered2_20 <- DESeq2_results2[Collection_date == 20]
dt_filtered3_20 <- DESeq2_results3[Collection_date == 20]

columns_to_keep <- c("Feature_ID", "log2FoldChange", "Collection_date","padj", "Species_group1", "Species_group2")

#dt_filtered1_20 <- na.omit(dt_filtered1_20[, ..columns_to_keep, with = FALSE])
dt_filtered2_20 <- na.omit(dt_filtered2_20[, ..columns_to_keep, with = FALSE])
dt_filtered3_20 <- na.omit(dt_filtered3_20[, ..columns_to_keep, with = FALSE])

# Combine data.tables by row
#combined_dt_20 <- rbindlist(list(dt_filtered1_20, dt_filtered2_20, dt_filtered3_20), fill = TRUE)
combined_dt_20 <- rbindlist(list(dt_filtered2_20, dt_filtered3_20), fill = TRUE)

newcombined_dt_20 <- subset(combined_dt_20, padj < 0.05)

# Merge rows based on the Feature_ID column
#newcombined_dt_20 <- combined_dt_20[, lapply(.SD, function(x) if(all(is.na(x))) NA else x), by = Feature_ID]

############################################# T35 ################################################################
# Filter rows where Collection_date is 0
#dt_filtered1_35 <- DESeq2_results1[Collection_date == 35]
dt_filtered2_35 <- DESeq2_results2[Collection_date == 35]
dt_filtered3_35 <- DESeq2_results3[Collection_date == 35]

columns_to_keep <- c("Feature_ID", "log2FoldChange", "Collection_date","padj", "Species_group1", "Species_group2")

#dt_filtered1_35 <- na.omit(dt_filtered1_35[, ..columns_to_keep, with = FALSE])
dt_filtered2_35 <- na.omit(dt_filtered2_35[, ..columns_to_keep, with = FALSE])
dt_filtered3_35 <- na.omit(dt_filtered3_35[, ..columns_to_keep, with = FALSE])

# Combine data.tables by row
#combined_dt_35 <- rbindlist(list(dt_filtered1_35, dt_filtered2_35, dt_filtered3_35), fill = TRUE)
combined_dt_35 <- rbindlist(list(dt_filtered2_35, dt_filtered3_35), fill = TRUE)

newcombined_dt_35 <- subset(combined_dt_35, padj < 0.05)

# Merge rows based on the Feature_ID column
#newcombined_dt_35 <- combined_dt_35[, lapply(.SD, function(x) if(all(is.na(x))) NA else x), by = Feature_ID]

```



# Merge the combined DESeq results with taxonomic information

```{r}
#Extract the row data from the SE object
taxonomy_dt <- as.data.table(as.data.frame(rowData(SE)), keep.rownames = "Feature_ID")

DESeq2_results_with_taxonomy_0 <- merge(
  newcombined_dt_0,
  taxonomy_dt,
  by = "Feature_ID"
)
DESeq2_results_with_taxonomy_5 <- merge(
  newcombined_dt_5,
  taxonomy_dt,
  by = "Feature_ID"
)
DESeq2_results_with_taxonomy_11 <- merge(
  newcombined_dt_11,
  taxonomy_dt,
  by = "Feature_ID"
)
DESeq2_results_with_taxonomy_20 <- merge(
  newcombined_dt_20,
  taxonomy_dt,
  by = "Feature_ID"
)
DESeq2_results_with_taxonomy_35 <- merge(
  newcombined_dt_35,
  taxonomy_dt,
  by = "Feature_ID"
)

# remove NA and uncultured rows
# Function to remove rows with values between +2 and -2 in the 'value_column'
remove_outliers <- function(dt, log2FoldChange) {
  dt <- dt[!(is.na(Family) | Family == "uncultured"| Family == "Unknown Family")]
  #dt <- dt[!(log2FoldChange >= -8 & log2FoldChange <= 8)]
  return(dt)
}

# Remove NA and uncultured rows, and outliers for each data.table
DESeq2_results_with_taxonomy_0 <- remove_outliers(DESeq2_results_with_taxonomy_0, log2FoldChange)
DESeq2_results_with_taxonomy_5 <- remove_outliers(DESeq2_results_with_taxonomy_5, log2FoldChange)
DESeq2_results_with_taxonomy_11 <- remove_outliers(DESeq2_results_with_taxonomy_11, log2FoldChange)
DESeq2_results_with_taxonomy_20 <- remove_outliers(DESeq2_results_with_taxonomy_20, log2FoldChange)
DESeq2_results_with_taxonomy_35 <- remove_outliers(DESeq2_results_with_taxonomy_35, log2FoldChange)

# Then, replace the empty Genus with "unknown-" followed by the name from Family
DESeq2_results_with_taxonomy_0[is.na(Genus), Genus := paste0("unknown-", Family)]
DESeq2_results_with_taxonomy_0[Genus == "uncultured", Genus := paste0("uncultured-", Family)]
DESeq2_results_with_taxonomy_5[is.na(Genus), Genus := paste0("unknown-", Family)]
DESeq2_results_with_taxonomy_5[Genus == "uncultured", Genus := paste0("uncultured-", Family)]
DESeq2_results_with_taxonomy_11[is.na(Genus), Genus := paste0("unknown-", Family)]
DESeq2_results_with_taxonomy_11[Genus == "uncultured", Genus := paste0("uncultured-", Family)]
DESeq2_results_with_taxonomy_20[is.na(Genus), Genus := paste0("unknown-", Family)]
DESeq2_results_with_taxonomy_20[Genus == "uncultured", Genus := paste0("uncultured-", Family)]
DESeq2_results_with_taxonomy_35[is.na(Genus), Genus := paste0("unknown-", Family)]
DESeq2_results_with_taxonomy_35[Genus == "uncultured", Genus := paste0("uncultured-", Family)]


```




# For each file individually:  extract data and prepare matrix for the heatmap
```{r}
# Assuming DESeq2_results_with_taxonomy is your data.table

# First, let's pivot the data to have Feature_ID as rows and Collection_date as columns
gheatmap_data1 <- dcast(DESeq2_results_with_taxonomy_0, Genus + ASV_ID ~ Species_group2, value.var = "log2FoldChange", fun.aggregate = mean)
gheatmap_data2 <- dcast(DESeq2_results_with_taxonomy_5, Genus + ASV_ID ~ Species_group2, value.var = "log2FoldChange", fun.aggregate = mean)
gheatmap_data3 <- dcast(DESeq2_results_with_taxonomy_11, Genus + ASV_ID ~ Species_group2, value.var = "log2FoldChange", fun.aggregate = mean)
gheatmap_data4 <- dcast(DESeq2_results_with_taxonomy_20, Genus + ASV_ID ~ Species_group2, value.var = "log2FoldChange", fun.aggregate = mean)
gheatmap_data5 <- dcast(DESeq2_results_with_taxonomy_35, Genus + ASV_ID ~ Species_group2, value.var = "log2FoldChange", fun.aggregate = mean)
#write_tsv(gheatmap_data1, file.path(DiffAbund_DIR, "ASV_Genus_T0_diffAbundabove8_E25_UV7_vs_Ac.tsv"))
#write_tsv(gheatmap_data2, file.path(DiffAbund_DIR, "ASV_Genus_T5_diffAbundabove8_E25_UV7_vs_Ac.tsv"))
#write_tsv(gheatmap_data3, file.path(DiffAbund_DIR, "ASV_Genus_T11_diffAbundabove8_E25_UV7_vs_Ac.tsv"))
#write_tsv(gheatmap_data4, file.path(DiffAbund_DIR, "ASV_Genus_T20_diffAbundabove8_E25_UV7_vs_Ac.tsv"))
#write_tsv(gheatmap_data5, file.path(DiffAbund_DIR, "ASV_Genus_T35_diffAbundabove8_E25_UV7_vs_Ac.tsv"))

# First, let's pivot the data to have Feature_ID as rows and Collection_date as columns
heatmap_data1 <- dcast(DESeq2_results_with_taxonomy_0, ASV_ID ~ Species_group2, value.var = "log2FoldChange", fun.aggregate = mean)
heatmap_data2 <- dcast(DESeq2_results_with_taxonomy_5, ASV_ID ~ Species_group2, value.var = "log2FoldChange", fun.aggregate = mean)
heatmap_data3 <- dcast(DESeq2_results_with_taxonomy_11, ASV_ID ~ Species_group2, value.var = "log2FoldChange", fun.aggregate = mean)
heatmap_data4 <- dcast(DESeq2_results_with_taxonomy_20, ASV_ID ~ Species_group2, value.var = "log2FoldChange", fun.aggregate = mean)
heatmap_data5 <- dcast(DESeq2_results_with_taxonomy_35, ASV_ID ~ Species_group2, value.var = "log2FoldChange", fun.aggregate = mean)

# reorder the columns to have ASV_ID, Genus and Ac
gheatmap_data1 <- gheatmap_data1[, c("ASV_ID", "Genus", "E25","UV7")]
gheatmap_data2 <- gheatmap_data2[, c("ASV_ID", "Genus",  "E25","UV7")]
gheatmap_data3 <- gheatmap_data3[, c("ASV_ID", "Genus",  "E25","UV7")]
gheatmap_data4 <- gheatmap_data4[, c("ASV_ID", "Genus",  "E25","UV7")]
gheatmap_data5 <- gheatmap_data5[, c("ASV_ID", "Genus", "E25","UV7")]

# Convert the data.table to a matrix
heatmap_matrix1 <- as.matrix(gheatmap_data1[, .(E25, UV7)])
heatmap_matrix2 <- as.matrix(gheatmap_data2[, .(E25, UV7)])
heatmap_matrix3 <- as.matrix(gheatmap_data3[, .(E25, UV7)])
heatmap_matrix4 <- as.matrix(gheatmap_data4[, .(E25, UV7)])
heatmap_matrix5 <- as.matrix(gheatmap_data5[, .(E25, UV7)])

heatmap_matrix1[is.nan(heatmap_matrix1)] <- 0
heatmap_matrix2[is.nan(heatmap_matrix2)] <- 0
heatmap_matrix3[is.nan(heatmap_matrix3)] <- 0
heatmap_matrix4[is.nan(heatmap_matrix4)] <- 0
heatmap_matrix5[is.nan(heatmap_matrix5)] <- 0


# Set row names to ASV_ID
rownames(heatmap_matrix1) <- gheatmap_data1$ASV_ID
rownames(heatmap_matrix2) <- gheatmap_data2$ASV_ID
rownames(heatmap_matrix3) <- gheatmap_data3$ASV_ID
rownames(heatmap_matrix4) <- gheatmap_data4$ASV_ID
rownames(heatmap_matrix5) <- gheatmap_data5$ASV_ID


# Create annotation for rows (Genus)
row_annotation1 <- data.frame(Genus = gheatmap_data1$Genus, row.names = gheatmap_data1$ASV_ID)
row_annotation2 <- data.frame(Genus = gheatmap_data2$Genus, row.names = gheatmap_data2$ASV_ID)
row_annotation3 <- data.frame(Genus = gheatmap_data3$Genus, row.names = gheatmap_data3$ASV_ID)
row_annotation4 <- data.frame(Genus = gheatmap_data4$Genus, row.names = gheatmap_data4$ASV_ID)
row_annotation5 <- data.frame(Genus = gheatmap_data5$Genus, row.names = gheatmap_data5$ASV_ID)




```
 
# Make a count file for how many ASVs can be found at each timepoint per genus
```{r}
A1 <- gheatmap_data1[, c("ASV_ID", "Genus", "Ac")]
A2 <- gheatmap_data1[, c("ASV_ID", "Genus", "Ac")]
A3 <- gheatmap_data1[, c("ASV_ID", "Genus", "Ac")]
A4 <- gheatmap_data1[, c("ASV_ID", "Genus", "Ac")]
A5 <- gheatmap_data1[, c("ASV_ID", "Genus", "Ac")]


 
countsA1 <- A1[, .(count = uniqueN(ASV_ID)), by = Genus]
countsA2 <- A2[, .(count = uniqueN(ASV_ID)), by = Genus]
countsA3 <- A3[, .(count = uniqueN(ASV_ID)), by = Genus]
countsA4 <- A4[, .(count = uniqueN(ASV_ID)), by = Genus]
countsA5 <- A5[, .(count = uniqueN(ASV_ID)), by = Genus]

# Count the number of unique ASV_IDs for each Genus
counts1 <- gheatmap_data1[, .(count = uniqueN(ASV_ID)), by = Genus]
counts2 <- gheatmap_data2[, .(count = uniqueN(ASV_ID)), by = Genus]
counts3 <- gheatmap_data3[, .(count = uniqueN(ASV_ID)), by = Genus]
counts4 <- gheatmap_data4[, .(count = uniqueN(ASV_ID)), by = Genus]
counts5 <- gheatmap_data5[, .(count = uniqueN(ASV_ID)), by = Genus]

#write_tsv(counts1, file.path(DiffAbund_DIR, "ASV_Genus_counts_T0_diffAbundabove8_E25_UV7_vs_Ac.tsv"))
#write_tsv(counts2, file.path(DiffAbund_DIR, "ASV_Genus_counts_T5_diffAbundabove8_E25_UV7_vs_Ac.tsv"))
#write_tsv(counts3, file.path(DiffAbund_DIR, "ASV_Genus_counts_T11_diffAbundabove8_E25_UV7_vs_Ac.tsv"))
#write_tsv(counts4, file.path(DiffAbund_DIR, "ASV_Genus_counts_T20_diffAbundabove8_E25_UV7_vs_Ac.tsv"))
#write_tsv(counts5, file.path(DiffAbund_DIR, "ASV_Genus_counts_T35_diffAbundabove8_E25_UV7_vs_Ac.tsv"))
```

# Define colours and breaks
```{r}
# Define breaks for the color scale
breaks <- seq(-25, 25, by = 1)  # Adjust the range and interval as needed
my_palette <- colorRampPalette(c("navy", "white", "firebrick3"))(49) # 49 number of colour break, important to have an uneven number, so that pure white exists in the middle for "0"s.

# Make colour palette for additional annotation
# Identify unique values in the 'Genus' column
unique_genus <- unique(row_annotation4$Genus)

# Define a default color for other characters
default_color <- "white"

# Create a color vector with specific colors for unique_genus and default_color for others
#my_color <- setNames(rep(default_color, length(unique_genus)), unique_genus)

# Override specific colors for known genera
#my_color[c("Burkholderia-Caballeronia-Paraburkholderia", "Chthoniobacter", "Edaphobaculum", "Mucilaginibacter", "Reyranella", "Sphingomonas", "uncultured-Micropepsaceae","Candidatus Protochlamydia", "Parachlamydia")] <- c("orange", "yellow2", "#90709a", "chartreuse1", "steelblue1", "brown", "steelblue4", "hotpink","hotpink" )

#my_color[c("Acidothermus", "Chthoniobacter", "Dongia", "Mucilaginibacter", "Pseudomonas", "Sphingomonas", "unknown-Caulobacteraceae","Candidatus Protochlamydia", "Parachlamydia")] <- c("orange", "yellow2", "#90709a", "chartreuse1", "steelblue1", "brown", "steelblue4", "hotpink","hotpink" )


#ann_colors = list(
  #  Genus =  my_color)

```



###################################### ###################################### ###################################### 
###################################### combined treatments + timepooints ########################################################

```{r}
# Then, replace the empty Genus with "unknown-" followed by the name from Family
DESeq2_results_with_taxonomy_0[, Species_group1 := paste0(Species_group1, "-0")]
DESeq2_results_with_taxonomy_0[, Species_group2 := paste0(Species_group2, "-0")]

DESeq2_results_with_taxonomy_5[, Species_group1 := paste0(Species_group1, "-5")]
DESeq2_results_with_taxonomy_5[, Species_group2 := paste0(Species_group2, "-5")]

DESeq2_results_with_taxonomy_11[, Species_group1 := paste0(Species_group1, "-11")]
DESeq2_results_with_taxonomy_11[, Species_group2 := paste0(Species_group2, "-11")]

DESeq2_results_with_taxonomy_20[, Species_group1 := paste0(Species_group1, "-20")]
DESeq2_results_with_taxonomy_20[, Species_group2 := paste0(Species_group2, "-20")]

DESeq2_results_with_taxonomy_35[, Species_group1 := paste0(Species_group1, "-35")]
DESeq2_results_with_taxonomy_35[, Species_group2 := paste0(Species_group2, "-35")]

# Combine data.tables by row
combined_dt <- rbindlist(list(DESeq2_results_with_taxonomy_0, DESeq2_results_with_taxonomy_5), fill = TRUE)
combined_dt <- rbindlist(list(combined_dt, DESeq2_results_with_taxonomy_11), fill = TRUE)
combined_dt <- rbindlist(list(combined_dt, DESeq2_results_with_taxonomy_20), fill = TRUE)
combined_dt <- rbindlist(list(combined_dt, DESeq2_results_with_taxonomy_35), fill = TRUE)


#write_tsv(combined_dt, file.path(DiffAbund_DIR, "Ac_Diffabund_taxa.tsv"))

```




# For each file individually:  extract data and prepare matrix for the heatmap
```{r}
# First, let's pivot the data to have Feature_ID as rows and Collection_date as columns
heatmap_data <- dcast(combined_dt, Genus ~ Species_group2, value.var = "log2FoldChange", fun.aggregate = mean)


# Manually reorder the columns based on custom order
# Extract Feature_ID column for row names
row_names <- heatmap_data$Genus

# Remove Feature_ID column from data
heatmap_data <- heatmap_data[, -1, with = FALSE]

# Convert the data.table to a matrix
heatmap_matrix <- as.matrix(heatmap_data)

heatmap_matrix[is.nan(heatmap_matrix)] <- 0

#custom_order <- c("Ac-0","Ac-5","Ac-11","Ac-20","Ac-35")
custom_order <- c("E25-0","UV7-0","E25-5","UV7-5","E25-11","UV7-11","E25-20","UV7-20","E25-35","UV7-35")

# Reorder the columns of heatmap_matrix according to the custom order
heatmap_matrix <- heatmap_matrix[, match(custom_order, colnames(heatmap_matrix)), drop = FALSE]

```

# Heatmap 

```{r}
# Plot heatmap using pheatmap
# Define breaks for the color scale
breaks <- seq(-25, 25, by = 1)  # Adjust the range and interval as needed
my_palette <- colorRampPalette(c("navy", "white", "firebrick3"))(49) # 49 number of colour break, important to have an uneven number, so that pure white exists in the middle for "0"s.

# Create heatmaps with consistent color scale
plot <- pheatmap(heatmap_matrix,
                  #cluster_rows = FALSE,
                  cluster_cols = FALSE,
                  labels_row = row_names,
                  main = "vs. Ac",
                  fontsize_row = 4.5,
                  fontsize_col = 4,
                  cellwidth = 12,
                  cellheight = 4.5,
                  color = my_palette,
                  border_color= "white",
                  breaks = breaks)
ggsave(
  file.path(PLOTS_DIR, g("{PROJECT_NAME}_Genus_DeSeq_Heatmap_Ac_vs_E25_UV7.svg")),
  plot = plot,
  width = 14,
  height = 23.5,
  units = "cm",
  dpi = 600
)
```

